<!doctype html>
<html lang="vi">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gi·ªè h√†ng - Drawer t·ª´ ph·∫£i (vanilla JS)</title>
  <style>
    :root {
      --drawer-width: 360px;
      --transition: 300ms;
      --backdrop-bg: rgba(0, 0, 0, 0.45);
      --accent: #1f6feb;
      --muted: #666;
      --surface: #fff;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      font-family: Inter, system-ui, Segoe UI, Roboto, "Helvetica Neue", Arial
    }

    .page {
      min-height: 100%;
      padding: 24px;
      background: #f6f7fb
    }

    /* Open cart button */
    .open-cart-btn {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      padding: 10px 14px;
      border-radius: 8px;
      background: var(--accent);
      color: white;
      border: 0;
      cursor: pointer
    }

    /* Backdrop */
    .backdrop {
      position: fixed;
      inset: 0;
      display: none;
      background: var(--backdrop-bg);
      z-index: 60;
      transition: opacity var(--transition) ease
    }

    .backdrop.show {
      display: block;
      opacity: 1
    }

    .backdrop.hidden {
      opacity: 0
    }

    /* Drawer */
    .drawer {
      position: fixed;
      right: 0;
      top: 0;
      height: 100%;
      width: var(--drawer-width);
      max-width: 100%;
      background: var(--surface);
      box-shadow: -18px 0 40px rgba(11, 22, 47, 0.18);
      transform: translateX(100%);
      transition: transform var(--transition) ease;
      z-index: 70;
      display: flex;
      flex-direction: column
    }

    .drawer.open {
      transform: translateX(0)
    }

    .drawer-header {
      padding: 18px;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px
    }

    .drawer-title {
      font-weight: 600
    }

    .close-btn {
      background: transparent;
      border: 0;
      font-size: 18px;
      cursor: pointer
    }

    .drawer-content {
      flex: 1;
      overflow: auto;
      padding: 16px
    }

    .cart-item {
      display: flex;
      gap: 12px;
      padding: 10px 0;
      border-bottom: 1px dashed #eee
    }

    .cart-thumb {
      width: 64px;
      height: 64px;
      border-radius: 8px;
      background: #f0f0f3;
      flex: 0 0 64px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--muted)
    }

    .cart-meta {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between
    }

    .cart-name {
      font-weight: 600
    }

    .cart-controls {
      display: flex;
      gap: 8px;
      align-items: center
    }

    .qty {
      display: inline-flex;
      align-items: center;
      border-radius: 6px;
      border: 1px solid #ddd;
      overflow: hidden
    }

    .qty button {
      background: transparent;
      border: 0;
      padding: 6px 8px;
      cursor: pointer
    }

    .qty span {
      min-width: 28px;
      text-align: center;
      display: inline-block
    }

    .drawer-footer {
      padding: 16px;
      border-top: 1px solid #eee
    }

    .total-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-weight: 700
    }

    .checkout-btn {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 0;
      background: var(--accent);
      color: white;
      cursor: pointer
    }

    /* Small responsive */
    @media (max-width:420px) {
      :root {
        --drawer-width: 100%
      }
    }

    /* Utility */
    .muted {
      color: var(--muted)
    }

    /* Focus outline for keyboard users */
    :focus {
      outline: 3px solid rgba(31, 111, 235, 0.18);
      outline-offset: 2px
    }
  </style>
</head>

<body>
  <div class="page">
    <h1>Shop demo</h1>
    <p>V√≠ d·ª• gi·ªè h√†ng 'drawer' tr∆∞·ª£t t·ª´ ph·∫£i sang b·∫±ng Vanilla JS ‚Äî kh√¥ng d√πng th∆∞ vi·ªán.</p>

    <button class="open-cart-btn" id="openCart">
      üõí M·ªü gi·ªè h√†ng <span id="cartCount"
        style="background:#e74646;padding:2px 6px;border-radius:999px;margin-left:6px;font-size:12px">3</span>
    </button>

    <main style="margin-top:20px">
      <p>Danh s√°ch s·∫£n ph·∫©m (demo):</p>
      <div style="display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr))">
        <article style="background:white;padding:12px;border-radius:8px;box-shadow:0 6px 18px rgba(12,20,40,0.04)">
          <h3>Gi√†y A</h3>
          <p class="muted">Gi√°: 350.000‚Ç´</p>
          <button onclick="addToCart('Gi√†y A',350000)" style="margin-top:8px">Th√™m v√†o gi·ªè</button>
        </article>
        <article style="background:white;padding:12px;border-radius:8px;box-shadow:0 6px 18px rgba(12,20,40,0.04)">
          <h3>Gi√†y B</h3>
          <p class="muted">Gi√°: 420.000‚Ç´</p>
          <button onclick="addToCart('Gi√†y B',420000)" style="margin-top:8px">Th√™m v√†o gi·ªè</button>
        </article>
        <article style="background:white;padding:12px;border-radius:8px;box-shadow:0 6px 18px rgba(12,20,40,0.04)">
          <h3>Gi√†y C</h3>
          <p class="muted">Gi√°: 290.000‚Ç´</p>
          <button onclick="addToCart('Gi√†y C',290000)" style="margin-top:8px">Th√™m v√†o gi·ªè</button>
        </article>
      </div>
    </main>
  </div>

  <!-- Backdrop + Drawer -->
  <div id="backdrop" class="backdrop hidden" aria-hidden="true"></div>

  <aside id="drawer" class="drawer" role="dialog" aria-modal="true" aria-labelledby="drawerTitle" tabindex="-1">
    <div class="drawer-header">
      <div>
        <div id="drawerTitle" class="drawer-title">Gi·ªè h√†ng</div>
        <div class="muted" id="drawerSub">3 s·∫£n ph·∫©m</div>
      </div>
      <div>
        <button class="close-btn" id="closeCart" aria-label="ƒê√≥ng gi·ªè h√†ng">‚úï</button>
      </div>
    </div>
    <div class="drawer-content" id="cartList">
      <!-- Items injected by JS -->
    </div>
    <div class="drawer-footer">
      <div class="total-row"><span>T·ªïng</span><span id="totalPrice">0‚Ç´</span></div>
      <button class="checkout-btn" id="checkout">Thanh to√°n</button>
    </div>
  </aside>

  <script>
    // Simple in-memory cart
    const cart = [
      { id: idGen(), name: 'Gi√†y A', price: 350000, qty: 1 },
      { id: idGen(), name: 'Gi√†y B', price: 420000, qty: 1 },
      { id: idGen(), name: 'Gi√†y C', price: 290000, qty: 1 },
    ];

    // Helpers
    function idGen() { return 'id_' + Math.random().toString(36).slice(2, 9) }
    function formatVND(n) { return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + '‚Ç´' }

    // Elements
    const openBtn = document.getElementById('openCart');
    const closeBtn = document.getElementById('closeCart');
    const backdrop = document.getElementById('backdrop');
    const drawer = document.getElementById('drawer');
    const cartList = document.getElementById('cartList');
    const totalPriceEl = document.getElementById('totalPrice');
    const cartCountEl = document.getElementById('cartCount');
    const drawerSub = document.getElementById('drawerSub');

    let lastFocused = null;

    // Render cart items
    function renderCart() {
      cartList.innerHTML = '';
      if (cart.length === 0) {
        cartList.innerHTML = '<p class="muted">Gi·ªè h√†ng tr·ªëng</p>';
        drawerSub.textContent = '0 s·∫£n ph·∫©m';
        cartCountEl.textContent = '0';
        totalPriceEl.textContent = '0‚Ç´';
        return;
      }
      cart.forEach(item => {
        const el = document.createElement('div');
        el.className = 'cart-item';
        el.innerHTML = `
          <div class="cart-thumb">ü•ø</div>
          <div class="cart-meta">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div class="cart-name">${escapeHtml(item.name)}</div>
                <div class="muted">${formatVND(item.price)}</div>
              </div>
              <div>
                <button onclick="removeItem('${item.id}')" aria-label="X√≥a ${escapeHtml(item.name)}">üóëÔ∏è</button>
              </div>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
              <div class="cart-controls">
                <div class="qty" aria-label="S·ªë l∆∞·ª£ng">
                  <button onclick="changeQty('${item.id}', -1)" aria-label="Gi·∫£m">-</button>
                  <span>${item.qty}</span>
                  <button onclick="changeQty('${item.id}', 1)" aria-label="TƒÉng">+</button>
                </div>
              </div>
              <div style="font-weight:700">${formatVND(item.price * item.qty)}</div>
            </div>
          </div>
        `;
        cartList.appendChild(el);
      });
      drawerSub.textContent = `${cart.reduce((s, i) => s + i.qty, 0)} s·∫£n ph·∫©m`;
      cartCountEl.textContent = `${cart.reduce((s, i) => s + i.qty, 0)}`;
      totalPriceEl.textContent = formatVND(cart.reduce((s, i) => s + i.price * i.qty, 0));
    }

    function escapeHtml(str) { return str.replace(/[&<>"']/g, tag => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", "\"": "&quot;", "'": "&#39;" }[tag])) }

    // Cart operations
    function addToCart(name, price) {
      const found = cart.find(i => i.name === name);
      if (found) { found.qty += 1 }
      else cart.push({ id: idGen(), name, price, qty: 1 });
      renderCart();
      openDrawer();
    }
    window.addToCart = addToCart; // expose for demo buttons

    function removeItem(id) {
      const idx = cart.findIndex(i => i.id === id);
      if (idx > -1) cart.splice(idx, 1);
      renderCart();
    }
    window.removeItem = removeItem;

    function changeQty(id, delta) {
      const item = cart.find(i => i.id === id);
      if (!item) return;
      item.qty += delta;
      if (item.qty <= 0) { removeItem(id); }
      renderCart();
    }
    window.changeQty = changeQty;

    // Drawer open/close
    function openDrawer() {
      lastFocused = document.activeElement;
      drawer.classList.add('open');
      backdrop.classList.remove('hidden');
      backdrop.classList.add('show');
      backdrop.setAttribute('aria-hidden', 'false');
      drawer.setAttribute('aria-hidden', 'false');
      drawer.focus();
      document.body.style.overflow = 'hidden';
      trapFocus(drawer);
    }

    function closeDrawer() {
      drawer.classList.remove('open');
      backdrop.classList.remove('show');
      backdrop.classList.add('hidden');
      backdrop.setAttribute('aria-hidden', 'true');
      drawer.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
      releaseFocusTrap();
      if (lastFocused) lastFocused.focus();
    }

    openBtn.addEventListener('click', () => { renderCart(); openDrawer(); });
    closeBtn.addEventListener('click', closeDrawer);
    backdrop.addEventListener('click', closeDrawer);

    // Close on Escape
    window.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeDrawer(); });

    // Focus trap (simple)
    let focusable = [];
    let firstFocusable = null;
    let lastFocusable = null;
    function trapFocus(container) {
      focusable = Array.from(container.querySelectorAll('a,button,input,select,textarea,[tabindex]:not([tabindex="-1"])')).filter(n => !n.disabled);
      if (focusable.length === 0) return;
      firstFocusable = focusable[0];
      lastFocusable = focusable[focusable.length - 1];
      container.addEventListener('keydown', handleTab);
    }
    function releaseFocusTrap() {
      drawer.removeEventListener('keydown', handleTab);
    }
    function handleTab(e) {
      if (e.key !== 'Tab') return;
      if (focusable.length === 0) return;
      if (e.shiftKey) {
        if (document.activeElement === firstFocusable) {
          e.preventDefault();
          lastFocusable.focus();
        }
      } else {
        if (document.activeElement === lastFocusable) {
          e.preventDefault();
          firstFocusable.focus();
        }
      }
    }

    // Initialize
    renderCart();

    // Prevent double click selection on long press for mobile
    backdrop.addEventListener('touchstart', () => { });
  </script>
</body>

</html>